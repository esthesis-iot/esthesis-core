<mat-card class="mat-card-flat">
  <mat-card-title>Send a command to devices</mat-card-title>
  <mat-card-content>
    <mat-vertical-stepper linear="true" #stepper>
      <mat-step [stepControl]="searchDevicesForm">
        <form [formGroup]="searchDevicesForm" id="searchDevices">
          <ng-template matStepLabel>Devices</ng-template>

          <div fxLayout="row" fxLayoutGap="1rem" class="xs-mt1">
            <mat-form-field fxFill>
              <input matInput placeholder="Hardware IDs" formControlName="hardwareIds">
              <div matSuffix class="matches">
                {{searchDevicesForm.controls['devicesMatchedByHardwareIds'].value}} matches
              </div>
            </mat-form-field>
          </div>

          <div fxLayout="row" fxLayoutGap="1rem">
            <mat-form-field fxFill>
              <input matInput placeholder="Tag" formControlName="tags">
              <div matSuffix class="matches">
                {{searchDevicesForm.controls['devicesMatchedByTags'].value}} matches
              </div>
            </mat-form-field>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="searchDevicesForm">
        <form [formGroup]="commandForm">
          <ng-template matStepLabel>Command</ng-template>
          <div fxLayout="row" fxLayoutGap="1rem" class="xs-mt1" fxFill>
            <mat-form-field fxFill>
              <mat-select placeholder="Command" formControlName="command">
                <mat-option *ngFor="let o of constants.DEVICE.COMMANDS| keyvalue"
                            [value]="o.value">
                  {{ lookupByValue(constants.DEVICE.COMMANDS, o.value) }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div *ngIf="commandForm.value.command == constants.DEVICE.COMMANDS.EXECUTE">
            <mat-form-field fxFill>
              <input matInput placeholder="Command arguments" formControlName="arguments">
            </mat-form-field>
          </div>

          <div *ngIf="commandForm.value.command == constants.DEVICE.COMMANDS.PROVISIONING">
            <mat-form-field fxFill>
              <mat-select placeholder="Provisioning package" formControlName="arguments">
                <mat-option *ngFor="let pp of provisioningPackages"
                            [value]="pp.id">{{pp.name}} - {{pp.packageVersion}}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div fxLayout="row" fxLayoutGap="1rem">
            <mat-form-field fxFill>
              <textarea [matTextareaAutosize]="true" [matAutosizeMinRows]=1 [matAutosizeMaxRows]=10
                        matInput placeholder="Description" formControlName="description"></textarea>
            </mat-form-field>
          </div>
        </form>
      </mat-step>
    </mat-vertical-stepper>
  </mat-card-content>
  <mat-card-actions>
    <button mat-button color="primary"
            [disabled]="!canDispatch()"
            (click)="execute()">DISPATCH</button>
    <button mat-button (click)="close()">CLOSE</button>
  </mat-card-actions>
</mat-card>
