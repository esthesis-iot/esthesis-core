<form novalidate [formGroup]="settingsForm" class="flex flex-col">
  <div class="font-bold text-xl mt-5">Geolocation telemetry attributes</div>
  <div class="mb-2">
    If your devices transmit geolocation coordinates you can choose which telemetry data
    corresponds to the latitude and the longitude. If these values are set, you can see your
    device's location on the device page on a map.
  </div>
  <mat-form-field>
    <mat-label>Longitude</mat-label>
    <input matInput [formControlName]="this.constants.DEVICE.SETTING.DEVICE_GEO_LON"
           [matAutocomplete]="autoLon">
    <mat-autocomplete #autoLon="matAutocomplete">
      <mat-option
        *ngFor="let measurement of allUniqueMeasurements" [value]="measurement">
        {{measurement}}
      </mat-option>
    </mat-autocomplete>
  </mat-form-field>

  <mat-form-field>
    <mat-label>Latitude</mat-label>
    <input matInput [formControlName]="this.constants.DEVICE.SETTING.DEVICE_GEO_LAT"
           [matAutocomplete]="autoLat">
    <mat-autocomplete #autoLat="matAutocomplete">
      <mat-option
        *ngFor="let measurement of allUniqueMeasurements" [value]="measurement">
        {{measurement}}
      </mat-option>
    </mat-autocomplete>
  </mat-form-field>

  <div class="flex flex-row" *ngIf="fetchingGeoAttributes">
    <fa-icon [spin]="true" icon="spinner" class="text-accent"></fa-icon>
    <div class="ml-2">fetching device measurements...</div>
  </div>


</form>

<form novalidate [formGroup]="profileDataForm" class="flex flex-col">
  <div class="font-bold text-xl mt-5">Device profile data</div>
  <div>
    Select which device data will be visible on device profile page. Custom formatting is
    supported via
    <a href="https://quarkus.io/guides/qute-reference" target="_blank" rel="noopener noreferrer">Qute</a>.
    The value can be referenced as <span class="font-mono">&#123;val&#125;</span>.
  </div>

  <div class="mt-2 flex flex-col grow">
    <div formArrayName="fields" *ngFor="let field of getFormFields(); let i = index" class="grow">
      <div [formGroupName]="i" class="flex flex-row mr-4">
        <input type="hidden" name="id" value="{{field.controls.id.value}}">
        <mat-checkbox formControlName="shown" class="mt-3"></mat-checkbox>
        <mat-form-field class="grow">
          <mat-label>Measurement</mat-label>
          <input matInput formControlName="measurement"
                 [matAutocomplete]="auto">
          <mat-autocomplete #auto="matAutocomplete">
            <mat-option
              *ngFor="let measurement of allUniqueMeasurements" [value]="measurement">
              {{measurement}}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>

        <mat-form-field class="grow">
          <mat-label>UI label</mat-label>
          <input matInput formControlName="label">
        </mat-form-field>

        <mat-form-field class="grow">
          <mat-label>Formatter</mat-label>
          <input matInput formControlName="formatter">
        </mat-form-field>

        <fa-icon icon="trash-can" (click)="deleteField(i)" matTooltip="Remove field"
                 class="cursor-pointer mt-2"></fa-icon>
      </div>
    </div>
  </div>
  <button class="btn btn-sm btm-secondary" (click)="newMeasurement()">Add measurement</button>
</form>

<button class="btn btn-sm btn-primary mt-10" (click)="save()" [disabled]="profileDataForm.invalid">
  SAVE
</button>
