<div class="card w-full bg-base-200 rounded-b-none">
  <div class="card-body">
    <h2 class="card-title text-2xl flex flex-row justify-between mb-5">
      <div class="flex flex-row gap-2">
        <fa-icon icon="broadcast-tower"></fa-icon>
        <div>New Command</div>
      </div>
    </h2>
    <div>
      <form [formGroup]="searchDevicesForm">
        <div>
          <div *ngIf="isSearching">
            <mat-spinner [diameter]="15" [strokeWidth]="1"></mat-spinner>
          </div>
        </div>
        <div>
          <mat-form-field class="w-full">
            <mat-label>Devices</mat-label>
            <input matInput placeholder="Search by hardware Id" [matAutocomplete]="auto"
                   formControlName="hardwareId">
            <mat-autocomplete #auto="matAutocomplete">
              <mat-option *ngFor="let device of searchDevices" [value]="device.hardwareId"
                          (click)="selectHardwareId(device.hardwareId)">
                <span>{{device.hardwareId}}</span>
              </mat-option>
            </mat-autocomplete>
          </mat-form-field>
        </div>

        <div *ngIf="selectedHardwareIds.length > 0" class="flex flex-row gap-2 flex-wrap mb-5">
          <span class="badge badge-md badge-primary" *ngFor="let id of selectedHardwareIds">
            {{ id }}
            <fa-icon icon="xmark" (click)="removeChip(id)" class="cursor-pointer"></fa-icon>
          </span>
        </div>

        <mat-form-field class="w-full">
          <mat-label>Tags</mat-label>
          <mat-select multiple formControlName="tags" class="mt1">
            <mat-option *ngFor="let tag of availableTags"
                        [value]="tag.name">{{tag.name}}</mat-option>
          </mat-select>
        </mat-form-field>
      </form>

      <form [formGroup]="commandForm" class="flex flex-col">
        <mat-form-field>
          <mat-label>Description</mat-label>
          <textarea cdkTextareaAutosize [cdkAutosizeMinRows]=1 [cdkAutosizeMaxRows]=10
                    matInput formControlName="description"></textarea>
        </mat-form-field>
        <mat-form-field>
          <mat-label>Command type</mat-label>
          <mat-select formControlName="commandType">
            <mat-option *ngFor="let o of appConstants.DEVICE.COMMAND.TYPE| keyvalue"
                        [value]="o.value">
              {{ lookupByValue(appConstants.DEVICE.COMMAND.TYPE, o.value) }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Execute -->
        <div class="flex flex-col ml-5"
             *ngIf="commandForm.value['commandType'] == appConstants.DEVICE.COMMAND.TYPE.EXECUTE">
          <mat-form-field>
            <mat-label>Execution type</mat-label>
            <mat-select formControlName="executionType">
              <mat-option *ngFor="let o of appConstants.DEVICE.COMMAND.EXECUTION| keyvalue"
                          [value]="o.value">
                {{ lookupByValue(appConstants.DEVICE.COMMAND.EXECUTION, o.value) }}
              </mat-option>
            </mat-select>
          </mat-form-field>
          <mat-form-field>
            <mat-label>Command</mat-label>
            <input matInput formControlName="command">
          </mat-form-field>
          <mat-form-field>
            <mat-label>Command arguments</mat-label>
            <input matInput formControlName="arguments">
          </mat-form-field>
        </div>

        <!-- Firmware -->
        <div class="flex flex-col ml-5"
             *ngIf="commandForm.value['commandType'] == appConstants.DEVICE.COMMAND.TYPE.FIRMWARE">
          <mat-form-field>
            <mat-label>Provisioning package</mat-label>
            <mat-select formControlName="command">
              <mat-option *ngFor="let pp of provisioningPackages"
                          [value]="pp.id">{{pp.name}} - {{pp.version}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </form>
    </div>
    <div class="card-actions justify-start mt-10">
      <button class="btn btn-sm btn-secondary" routerLink="/command">CANCEL</button>
      <button class="btn btn-sm btn-primary" [disabled]="!canDispatch()" (click)="save()">DISPATCH
      </button>
    </div>
  </div>
</div>
