<mat-card>
  <mat-card-title>Send a command to devices</mat-card-title>
  <mat-card-content fxLayout="column">
    <div class="inline-header" fxLayout="row" fxLayoutGap="1rem">
      <div>Devices</div>
      <div *ngIf="isSearching">
        <mat-spinner [diameter]="15" [strokeWidth]="1"></mat-spinner>
      </div>
    </div>

    <form [formGroup]="searchDevicesForm">
      <div fxLayout="row" fxLayoutGap="1rem">
        <mat-form-field fxFill>
          <input matInput placeholder="Hardware IDs" formControlName="hardwareIds">
          <div matSuffix class="matches">
            {{searchDevicesForm.controls['devicesMatchedByHardwareIds'].value}} devices
          </div>
        </mat-form-field>
      </div>
      <div fxLayout="row" fxLayoutGap="1rem">
        <mat-form-field fxFill>
          <input matInput placeholder="Tag" formControlName="tags">
          <div matSuffix class="matches">
            {{searchDevicesForm.controls['devicesMatchedByTags'].value}} devices
          </div>
        </mat-form-field>
      </div>
    </form>

    <div class="inline-header">Command</div>
    <form [formGroup]="commandForm" fxLayout="column">
      <mat-form-field>
        <mat-select placeholder="Command type" formControlName="commandType">
          <mat-option *ngFor="let o of appConstants.DEVICE.COMMAND.TYPE| keyvalue"
                      [value]="o.value">
            {{ lookupByValue(appConstants.DEVICE.COMMAND.TYPE, o.value) }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field
        *ngIf="commandForm.value['commandType'] == appConstants.DEVICE.COMMAND.TYPE.EXECUTE">
        <mat-select placeholder="Command execution type" formControlName="executionType">
          <mat-option *ngFor="let o of appConstants.DEVICE.COMMAND.EXECUTION| keyvalue"
                      [value]="o.value">
            {{ lookupByValue(appConstants.DEVICE.COMMAND.EXECUTION, o.value) }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field
        *ngIf="commandForm.value['commandType'] == appConstants.DEVICE.COMMAND.TYPE.EXECUTE">
        <input matInput placeholder="Command" formControlName="command">
      </mat-form-field>
      <mat-form-field
        *ngIf="commandForm.value['commandType'] == appConstants.DEVICE.COMMAND.TYPE.EXECUTE">
        <input matInput placeholder="Command arguments" formControlName="arguments">
      </mat-form-field>
      <mat-form-field
        *ngIf="commandForm.value['commandType'] == appConstants.DEVICE.COMMAND.TYPE.FIRMWARE">
        <mat-select placeholder="Provisioning package" formControlName="arguments">
          <mat-option *ngFor="let pp of provisioningPackages"
                      [value]="pp.id">{{pp.name}} - {{pp.packageVersion}}</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field>
            <textarea cdkTextareaAutosize [cdkAutosizeMinRows]=1 [cdkAutosizeMaxRows]=10
                      matInput placeholder="Description" formControlName="description"></textarea>
      </mat-form-field>
    </form>
  </mat-card-content>
  <mat-card-actions>
    <button mat-button routerLink="/command">CANCEL</button>
    <button mat-button color="primary" [disabled]="!canDispatch()" (click)="save()">DISPATCH
    </button>
  </mat-card-actions>
</mat-card>
