<mat-card>
  <div *ngIf="!isNiFiConfigured">
    <mat-error>
      {{!hasActiveNiFi ? 'No active NiFi instance found.' : 'No NiFi Digital Twin url found.'}}
      Pseudo-terminal is disabled.
    </mat-error>
  </div>
  <mat-card-title>Device <span class="hardware-id">{{hardwareId}}</span></mat-card-title>
  <mat-card-content>
    <form novalidate [formGroup]="form" fxLayout="column">
      <mat-form-field style="max-width: 15rem">
        <mat-select formControlName="state" placeholder="Status">
          <mat-option *ngFor="let o of constants.DEVICE.STATE | keyvalue" [value]="o.value">
            {{ lookupByValue(constants.DEVICE.STATE, o.value) }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <div fxLayout="column">
        <div fxLayout="row" *ngIf="!fetchingDeviceData">
          <div fxLayout="row wrap" fxFlex="80%" fxFlexAlign="start" *ngIf="!isArrayEmpty(fields)">
            <div class="xs-mb05" fxLayout="row" fxFlex="40%" *ngFor="let field of fields; let i = index">
              <div class="label">{{field.label ? field.label : field.field}}:</div>
              <div [matTooltip]="getLastUpdatedDate(field.lastUpdatedOn)"
                   class="value">{{fieldsValues.get(field.measurement + "." + field.field)}}</div>
            </div>
          </div>
          <div class="map-wrapper" [style.visibility]="deviceHasGeolocation? 'visible': 'hidden'" fxLayout="column">
            <div class="map-container" leaflet fxFlex="10rem" [leafletOptions]="mapOptions"></div>
          </div>
        </div>
        <div fxLayout="row" *ngIf="fetchingDeviceData">
          <mat-spinner [diameter]="15" [strokeWidth]="1"></mat-spinner>
        </div>

        <mat-form-field class="xs-mt1" style="max-width: 15rem">
          <mat-select placeholder="Tags" multiple formControlName="tags">
            <mat-option *ngFor="let tag of availableTags" [value]="tag.id">{{tag.name}}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-card-actions>
          <button mat-button [matMenuTriggerFor]="menu">DOWNLOAD
            <mat-menu #menu="matMenu" xPosition="before">
              <button mat-menu-item (click)="downloadKeys()">Cryptographic keys</button>
            </mat-menu>
          </button>
          <button mat-button routerLink="/devices" fragment="mqtt">CANCEL</button>
          <button mat-button color="accent" (click)="delete()" [disabled]="this.id == 0">DELETE
          </button>
          <button mat-button color="primary" (click)="save()" [disabled]="form.invalid">SAVE
          </button>
        </mat-card-actions>

        <mat-tab-group animationDuration="0ms">
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon>developer_board</mat-icon>
              Profile
            </ng-template>
            <ng-template matTabContent>
              <app-device-profile></app-device-profile>
            </ng-template>
          </mat-tab>
          <mat-tab [disabled]="!isNiFiConfigured">
            <ng-template mat-tab-label>
              <mat-icon>keyboard</mat-icon>
              Pseudo-terminal
            </ng-template>
            <ng-template matTabContent>
              <app-device-terminal [hardwareId]="hardwareId"></app-device-terminal>
            </ng-template>
          </mat-tab>
        </mat-tab-group>
      </div>
    </form>
  </mat-card-content>
</mat-card>
